{% extends "base.html" %}
{% block title %}ëŒ€ì‹œë³´ë“œ - ë„¤ì´ë²„ ìˆœìœ„ íŠ¸ë˜ì»¤{% endblock %}
{% block content %}

<div class="page-header" style="display:flex;align-items:center;justify-content:space-between;">
  <div>
    <div class="page-title">ğŸ“Š ê´‘ê³ ì£¼ ëŒ€ì‹œë³´ë“œ</div>
    <div class="page-sub">ê´‘ê³ ì£¼ë³„ ë„¤ì´ë²„ ì‡¼í•‘ ìˆœìœ„ í˜„í™©</div>
  </div>
</div>

<!-- ê´‘ê³ ì£¼ ì¶”ê°€ í¼ -->
<div class="card">
  <div class="card-title">â• ê´‘ê³ ì£¼ ì¶”ê°€</div>
  <form action="/clients/add" method="post">
    <div class="form-row">
      <div class="form-group">
        <label>ê´‘ê³ ì£¼ëª… *</label>
        <input type="text" name="name" placeholder="ì˜ˆ: í™ê¸¸ë™ìŠ¤í† ì–´" required>
      </div>
      <div class="form-group">
        <label>ë©”ëª¨ (ì„ íƒ)</label>
        <input type="text" name="memo" placeholder="ì˜ˆ: ë·°í‹° ë¸Œëœë“œ, 3ê°œ ìƒí’ˆ ê´€ë¦¬ ì¤‘">
      </div>
      <div style="align-self:flex-end;">
        <button type="submit" class="btn btn-primary">ì¶”ê°€</button>
      </div>
    </div>
  </form>
</div>

<!-- ê´‘ê³ ì£¼ ëª©ë¡ -->
{% if clients %}
<div class="card">
  <div class="card-title">ğŸ“‹ ê´‘ê³ ì£¼ ëª©ë¡ ({{ clients|length }}ê°œ)</div>
  <table>
    <thead>
      <tr>
        <th>ê´‘ê³ ì£¼ëª…</th>
        <th>ë©”ëª¨</th>
        <th>ì¶”ì  ì¡°í•©</th>
        <th>ìˆœìœ„ê¶Œ</th>
        <th>ìµœê³ ìˆœìœ„</th>
        <th>ë§ˆì§€ë§‰ í™•ì¸</th>
        <th>ê´€ë¦¬</th>
      </tr>
    </thead>
    <tbody>
    {% for cl in clients %}
    {% set s = summary.get(cl.id, {}) %}
    <tr style="cursor:pointer;" onclick="location.href='/clients/{{ cl.id }}'">
      <td>
        <a href="/clients/{{ cl.id }}" style="color:#03c75a;font-weight:700;">{{ cl.name }}</a>
      </td>
      <td style="color:#64748b;font-size:.82rem;">{{ cl.memo or '-' }}</td>
      <td>
        {% if s.total_combos %}
          <span class="badge badge-blue">{{ s.total_combos }}ê±´</span>
        {% else %}
          <span style="color:#475569">-</span>
        {% endif %}
      </td>
      <td>
        {% if s.in_rank is not none and s.total_combos %}
          <span class="badge badge-green">{{ s.in_rank }} / {{ s.total_combos }}</span>
        {% else %}
          <span style="color:#475569">-</span>
        {% endif %}
      </td>
      <td>
        {% if s.best_rank %}
          <span class="rank-{% if s.best_rank <= 10 %}top{% elif s.best_rank <= 30 %}good{% elif s.best_rank <= 100 %}mid{% else %}low{% endif %}">
            {{ s.best_rank }}ìœ„
          </span>
        {% else %}
          <span style="color:#475569">-</span>
        {% endif %}
      </td>
      <td style="color:#64748b;font-size:.8rem;">{{ s.last_check or '-' }}</td>
      <td onclick="event.stopPropagation()">
        <form action="/clients/{{ cl.id }}/delete" method="post" onsubmit="return confirm('ê´‘ê³ ì£¼ {{ cl.name }}ì„ ì‚­ì œí• ê¹Œìš”? ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')">
          <button type="submit" class="btn btn-danger btn-sm">ì‚­ì œ</button>
        </form>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="card" style="text-align:center;padding:48px;color:#475569;">
  <div style="font-size:3rem;margin-bottom:12px;">ğŸ“­</div>
  <div style="font-size:1rem;margin-bottom:6px;">ë“±ë¡ëœ ê´‘ê³ ì£¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  <div style="font-size:.85rem;">ìœ„ í¼ì—ì„œ ê´‘ê³ ì£¼ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>
</div>
{% endif %}

{% endblock %}
